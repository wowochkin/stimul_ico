# üö® –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: Gunicorn –ø–∞–¥–∞–ª –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ

## –ù–∞–π–¥–µ–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞

–í –ª–æ–≥–∞—Ö –≤–∏–¥–Ω–æ, —á—Ç–æ Gunicorn **–ø–∞–¥–∞–ª —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –≤—ã–≤–æ–¥–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**:

```
logconfig_dict: {}
[–ö–û–ù–ï–¶ –õ–û–ì–ê - –±–æ–ª—å—à–µ –Ω–∏—á–µ–≥–æ –Ω–µ—Ç]
```

**–ù–ï –ë–´–õ–û** —Å–æ–æ–±—â–µ–Ω–∏–π:
- `Starting gunicorn`
- `Listening at:`
- `Booting worker with pid:`

Worker –≤–æ–æ–±—â–µ –Ω–µ –∑–∞–ø—É—Å–∫–∞–ª—Å—è!

## –ü—Ä–∏—á–∏–Ω–∞

1. **`chdir = '/app/backend'` –≤ gunicorn.conf.py** - –∫–æ–≥–¥–∞ Gunicorn –ø—ã—Ç–∞–ª—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥, –æ–Ω –µ—â–µ –Ω–µ —Å–¥–µ–ª–∞–ª chdir, –∏ callbacks –º–æ–≥–ª–∏ –ø–∞–¥–∞—Ç—å
2. **Callbacks –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–ª–∏ Django** - —ç—Ç–æ –º–æ–≥–ª–æ –≤—ã–∑—ã–≤–∞—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏—è –¥–æ –∑–∞–ø—É—Å–∫–∞ worker'–æ–≤
3. **–°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤ callbacks** - –ª—é–±–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ —É–±–∏–≤–∞–ª–æ worker

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –£–±—Ä–∞–Ω `chdir` –∏–∑ gunicorn.conf.py

**–ë—ã–ª–æ**:
```python
chdir = '/app/backend'  # –í –∫–æ–Ω—Ñ–∏–≥–µ
```

**–°—Ç–∞–ª–æ**:
```bash
# –í entrypoint.sh
cd /app/backend
exec gunicorn --config /app/gunicorn.conf.py stimul_ico.wsgi:application
```

### 2. –£–ø—Ä–æ—â–µ–Ω—ã –≤—Å–µ callbacks

**–ë—ã–ª–æ**:
```python
def post_worker_init(worker):
    import django
    from django.conf import settings
    # –°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ Django
```

**–°—Ç–∞–ª–æ**:
```python
def post_worker_init(worker):
    try:
        print(f"‚úÖ Worker {worker.pid} –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω")
    except:
        pass  # –ù–µ –ø–∞–¥–∞–µ–º –Ω–∏ –ø—Ä–∏ –∫–∞–∫–∏—Ö –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤–∞—Ö
```

### 3. –í—Å–µ callbacks –æ–±–µ—Ä–Ω—É—Ç—ã –≤ try/except

–¢–µ–ø–µ—Ä—å **–ù–ò–ö–ê–ö–û–ô** callback –Ω–µ –º–æ–∂–µ—Ç —É–±–∏—Ç—å worker.

## –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –¥–µ–ø–ª–æ—è –≤ –ª–æ–≥–∞—Ö **–î–û–õ–ñ–ù–´** –ø–æ—è–≤–∏—Ç—å—Å—è:

```
üìÇ –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ /app/backend –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ Django
üöÄ Gunicorn –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ 0.0.0.0:8080
üë∑ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ workers: 1
[2025-10-25 XX:XX:XX +0000] [1] [INFO] Starting gunicorn 21.2.0
[2025-10-25 XX:XX:XX +0000] [1] [INFO] Listening at: http://0.0.0.0:8080 (1)
[2025-10-25 XX:XX:XX +0000] [1] [INFO] Using worker: sync
[2025-10-25 XX:XX:XX +0000] [10] [INFO] Booting worker with pid: 10
‚úÖ Gunicorn –≥–æ—Ç–æ–≤ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã
‚úÖ Worker 10 –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
```

–ï—Å–ª–∏ —ç—Ç–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ—è–≤—è—Ç—Å—è - **Gunicorn –∑–∞–ø—É—Å—Ç–∏–ª—Å—è —É—Å–ø–µ—à–Ω–æ!**

## –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ "connection refused"

–ï—Å–ª–∏ –ø–æ—Å–ª–µ —ç—Ç–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤—Å–µ –µ—â–µ "connection refused", –Ω–æ Gunicorn –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è, —Ç–æ –ø—Ä–æ–±–ª–µ–º–∞ –≤:

1. **–°–µ—Ç–µ–≤—ã—Ö –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Railway** - proxy –Ω–µ –º–æ–∂–µ—Ç –¥–æ—Å—Ç—É—á–∞—Ç—å—Å—è
2. **Firewall/Security groups** - –ø–æ—Ä—Ç 8080 –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
3. **Bind address** - –≤–æ–∑–º–æ–∂–Ω–æ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π –∞–¥—Ä–µ—Å

–í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –Ω—É–∂–Ω–æ:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Railway —Å–µ—Ç–µ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
2. –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π –ø–æ—Ä—Ç
3. –°–≤—è–∑–∞—Ç—å—Å—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Railway

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

### –®–∞–≥ 1: –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –¥–µ–ø–ª–æ—è

Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Å–æ–±–µ—Ä–µ—Ç –∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç.

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏

–ò—â–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è:
- ‚úÖ `Starting gunicorn` - Gunicorn –∑–∞–ø—É—Å—Ç–∏–ª—Å—è
- ‚úÖ `Listening at:` - –°–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç
- ‚úÖ `Booting worker with pid:` - Worker –∑–∞–ø—É—â–µ–Ω

### –®–∞–≥ 3: –ü–æ–ø—Ä–æ–±—É–π—Ç–µ endpoints

```bash
curl https://stimulico-production.up.railway.app/ultra-simple/
curl https://stimulico-production.up.railway.app/health/
curl https://stimulico-production.up.railway.app/
```

### –®–∞–≥ 4: –û—Ç–ø—Ä–∞–≤—å—Ç–µ –ª–æ–≥–∏

–û—Ç–ø—Ä–∞–≤—å—Ç–µ –º–Ω–µ:
1. **–ü–æ–ª–Ω—ã–µ –ª–æ–≥–∏ –¥–µ–ø–ª–æ—è** - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç Gunicorn
2. **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã curl** - —á—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç endpoints
3. **–û—à–∏–±–∫–∏ Railway** - –µ—Å–ª–∏ –≤—Å–µ –µ—â–µ 502

## –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —É—Å–ø–µ—Ö–∞

**–í–´–°–û–ö–ê–Ø** - —ç—Ç–æ –±—ã–ª–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–¥–µ–Ω–∏—è Gunicorn –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ.

Worker –Ω–µ –º–æ–≥ –¥–∞–∂–µ —Å—Ç–∞—Ä—Ç–æ–≤–∞—Ç—å –∏–∑-–∑–∞ –ø—Ä–æ–±–ª–µ–º —Å chdir –∏ callbacks.

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è Gunicorn —Ç–æ—á–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è, –∏ –º—ã —É–≤–∏–¥–∏–º:
- ‚úÖ –õ–∏–±–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –õ–∏–±–æ –ø–æ–ª—É—á–∏–º –ù–ê–°–¢–û–Ø–©–£–Æ –æ—à–∏–±–∫—É –≤ –ª–æ–≥–∞—Ö (–Ω–µ "connection refused")

–í –ª—é–±–æ–º —Å–ª—É—á–∞–µ - —ç—Ç–æ –ø—Ä–æ–≥—Ä–µ—Å—Å! üöÄ

