{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}Стимулирующие выплаты ИЦО МГПУ{% endblock %}</title>
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
</head>
<body>
<header class="header">
    <div class="header-left">
        <button class="menu-toggle" id="menu-toggle" aria-label="Открыть меню">
            <span></span>
            <span></span>
            <span></span>
        </button>
        <a href="{% if user.is_authenticated %}{% url 'request-list' %}{% else %}{% url 'login' %}{% endif %}" class="logo-link">ИЦО МГПУ · Стимулирующие выплаты</a>
    </div>
    <div class="header-content">
        <nav class="header-nav">
            {% if user.is_authenticated %}
                {% if perms.staffing.view_positionquota %}
                    <a href="{% url 'staffing:quota-list' %}">Штатное расписание</a>
                {% endif %}
                {% if perms.recurring_payments.view_recurringperiod %}
                    <a href="{% url 'recurring_payments:period-list' %}">Постоянные выплаты</a>
                {% endif %}
                {% if perms.stimuli.view_employee %}
                    <a href="{% url 'employee-list' %}">Сотрудники</a>
                {% endif %}
                {% if perms.one_time_payments.view_requestcampaign %}
                    <a href="{% url 'one_time_payments:campaign-list' %}">Заявки и разовые выплаты</a>
                {% else %}
                    <a href="{% url 'request-list' %}">Заявки</a>
                {% endif %}
                {% if perms.dashboard.view_dashboard %}
                    <a href="{% url 'dashboard:overview' %}">Дэшборд</a>
                {% endif %}
                {% if user.is_staff %}
                    <a href="{% url 'admin:index' %}">Админка</a>
                {% endif %}
            {% endif %}
        </nav>
        {% if user.is_authenticated %}
            <form method="post" action="{% url 'logout' %}" class="logout-form">
                {% csrf_token %}
                <button type="submit" class="logout-link">Выйти</button>
            </form>
        {% endif %}
    </div>
</header>

<!-- Сайдбар -->
<aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
        <strong>Меню</strong>
        <button class="menu-close" id="menu-close" aria-label="Закрыть меню">×</button>
    </div>
    <nav class="sidebar-nav">
        {% if user.is_authenticated %}
            {% if perms.staffing.view_positionquota %}
                <a href="{% url 'staffing:quota-list' %}">Штатное расписание</a>
            {% endif %}
            {% if perms.recurring_payments.view_recurringperiod %}
                <a href="{% url 'recurring_payments:period-list' %}">Постоянные выплаты</a>
            {% endif %}
            {% if perms.stimuli.view_employee %}
                <a href="{% url 'employee-list' %}">Сотрудники</a>
            {% endif %}
            {% if perms.one_time_payments.view_requestcampaign %}
                <a href="{% url 'one_time_payments:campaign-list' %}">Заявки и разовые выплаты</a>
            {% else %}
                <a href="{% url 'request-list' %}">Заявки</a>
            {% endif %}
            {% if perms.dashboard.view_dashboard %}
                <a href="{% url 'dashboard:overview' %}">Дэшборд</a>
            {% endif %}
            {% if user.is_staff %}
                <a href="{% url 'admin:index' %}">Админка</a>
            {% endif %}
            <form method="post" action="{% url 'logout' %}" class="logout-form">
                {% csrf_token %}
                <button type="submit" class="logout-link sidebar-logout">Выйти</button>
            </form>
        {% endif %}
    </nav>
</aside>

<!-- Overlay для затемнения фона -->
<div class="sidebar-overlay" id="sidebar-overlay"></div>
<div class="container">
    {% if messages %}
        <div class="messages">
            {% for message in messages %}
                <div class="flash flash-{{ message.tags|default:'info' }}">{{ message }}</div>
            {% endfor %}
        </div>
    {% endif %}
    {% block content %}{% endblock %}
</div>
<script src="{% static 'js/autosubmit.js' %}"></script>
<script src="{% static 'js/bulk-actions.js' %}"></script>
<script src="{% static 'js/sidebar.js' %}"></script>
{% block extra_scripts %}{% endblock %}
</body>
</html>
