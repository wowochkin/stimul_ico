# Команды управления кампаниями

## auto_close_campaigns

Автоматически закрывает кампании, у которых истек дедлайн.

### Использование

```bash
# Режим dry-run (показать, какие кампании будут закрыты, без фактического закрытия)
python manage.py auto_close_campaigns --dry-run

# Закрыть кампании
python manage.py auto_close_campaigns
```

### Настройка автоматического выполнения

#### Через cron (Linux/macOS)

Откройте crontab:
```bash
crontab -e
```

Добавьте строку для ежедневного выполнения в 00:05 (5 минут после полуночи):
```
5 0 * * * cd /path/to/Stimul_ICO/backend && /path/to/python manage.py auto_close_campaigns >> /var/log/campaign_auto_close.log 2>&1
```

Замените `/path/to/Stimul_ICO/backend` и `/path/to/python` на актуальные пути.

#### Пример для виртуального окружения

```
5 0 * * * cd /home/user/Stimul_ICO/backend && /home/user/venv/bin/python manage.py auto_close_campaigns >> /var/log/campaign_auto_close.log 2>&1
```

### Логика работы

1. Команда запускается и находит все открытые кампании с включенным флагом автоматического закрытия (`auto_close_enabled=True`)
2. Для каждой кампании проверяется метод `should_auto_close()`, который возвращает `True`, если:
   - Кампания открыта
   - Флаг автозакрытия включен
   - Указан дедлайн
   - Текущая дата больше дедлайна (наступил день после дедлайна)
3. Кампании, удовлетворяющие условиям, автоматически закрываются

### Пример

Если дедлайн кампании установлен на `07.11.2025`, то кампания будет автоматически закрыта `08.11.2025` в 00:05 (если команда запускается в 00:05).

### Важные замечания

- Команда не архивирует кампании автоматически, только закрывает их (переводит в статус "Закрыта")
- Архивирование кампании должно быть выполнено вручную через интерфейс администратора
- Для производственной среды рекомендуется настроить логирование и мониторинг выполнения команды

