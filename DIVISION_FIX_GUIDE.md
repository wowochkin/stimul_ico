# Решение проблемы с отсутствующими подразделениями на деплое

## Проблема

При загрузке Excel файла с сотрудниками на деплое в Railway возникают ошибки:
```
Ошибки при обработке файла: 
Строка 2: Подразделение 'ИЦО' не найдено
Строка 3: Подразделение 'Департамент информатики, управления и технологий' не найдено
...
```

## Причина

В коде загрузки Excel файла была строгая проверка существования подразделений и должностей в базе данных. Если подразделение не найдено, выдавалась ошибка вместо автоматического создания.

## Решение

### Вариант 1: Быстрое решение (рекомендуется)

Выполните команду для создания основных подразделений и должностей:

```bash
python manage.py create_basic_divisions
```

Эта команда создаст все подразделения из ошибки пользователя и основные должности.

### Вариант 2: Создание из Excel файла

Если у вас есть Excel файл с сотрудниками, можно создать подразделения и должности из него:

```bash
# Сначала посмотрите что будет создано (dry-run)
python manage.py create_divisions_from_excel /path/to/your/file.xlsx --dry-run

# Затем создайте фактически
python manage.py create_divisions_from_excel /path/to/your/file.xlsx
```

### Вариант 3: Автоматическое создание при загрузке

Теперь при загрузке Excel файла система автоматически создает недостающие подразделения и должности. Ошибки больше не будут возникать.

## Что изменилось в коде

1. **Создана команда `create_basic_divisions`** - быстро создает основные подразделения и должности
2. **Создана команда `create_divisions_from_excel`** - создает подразделения и должности из Excel файла
3. **Модифицирована логика загрузки Excel** - теперь автоматически создает недостающие записи вместо выдачи ошибок

## Инструкции для деплоя

### На Railway (через Web Console):

1. Выполните команду создания основных подразделений:
```bash
python backend/manage.py create_basic_divisions
```

2. Теперь можно загружать Excel файл с сотрудниками - система автоматически создаст недостающие подразделения и должности.

### Альтернативно:

Если у вас есть Excel файл, можете создать подразделения из него:
```bash
python backend/manage.py create_divisions_from_excel /path/to/excel/file.xlsx
```

## Проверка

После выполнения команды проверьте:
1. Зайдите в админку Django
2. Проверьте раздел "Подразделения" - должны быть все нужные подразделения
3. Проверьте раздел "Должности" - должны быть основные должности
4. Попробуйте загрузить Excel файл с сотрудниками

## Преимущества нового подхода

- ✅ Не нужно перезаписывать базу данных при обновлении репозитория
- ✅ Автоматическое создание недостающих записей
- ✅ Сохранение существующих данных
- ✅ Информативные сообщения о созданных записях
- ✅ Возможность предварительного просмотра (dry-run)
